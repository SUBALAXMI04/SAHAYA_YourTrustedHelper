<!-- Page Protection and Navigation -->
<script>
  // Protect pages - ensure user is logged in and has correct role
  function protectPage(requiredRole = null) {
    const token = localStorage.getItem('token');
    const userType = localStorage.getItem('userType');

    // Redirect if not logged in
    if (!token) {
      window.location.href = '/landing.html';
      return false;
    }

    // If specific role required, check it
    if (requiredRole && userType !== requiredRole) {
      window.location.href = '/landing.html';
      return false;
    }

    return true;
  }

  // Auto-protect specific pages on load
  document.addEventListener('DOMContentLoaded', function() {
    const currentPage = window.location.pathname;
    const currentFile = currentPage.split('/').pop();

    // Define which pages need protection and what role
    const protectedPages = {
      'find-service.html': 'user',
      'my-bookings.html': 'user',
      'payment.html': 'user',
      'reviews-page.html': 'user',
      'profile-settings.html': 'user',
      'saved-professionals.html': 'user',
      'give-review.html': 'user',
      'provider-profile.html': 'user',
      'chat.html': 'user',
      'dashboard2.html': 'provider',
      'provider-earnings.html': 'provider',
      'admin-panel.html': 'admin'
    };

    if (protectedPages[currentFile]) {
      protectPage(protectedPages[currentFile]);
    }
  });

  // Logout function
  function logout() {
    localStorage.clear();
    window.location.href = '/landing.html';
  }

  // Add theme toggle globally
  function initGlobalTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);
  }

  function applyTheme(theme) {
    if (theme === 'dark') {
      document.body.classList.add('dark-mode');
      document.body.classList.remove('light-mode');
    } else {
      document.body.classList.add('light-mode');
      document.body.classList.remove('dark-mode');
    }
    localStorage.setItem('theme', theme);
  }

  function toggleTheme() {
    const currentTheme = localStorage.getItem('theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
  }

  // Initialize theme on all pages
  initGlobalTheme();
</script>

<!-- Global Styles for Dark Mode -->
<style>
  :root {
    --royal-blue: #4169E1;
    --royal-blue-light: #5B7FED;
    --moonlight-light: #E0E6FF;
    --moonlight-dark: #D0D8F4;
    --text-dark: #333;
    --text-light: #666;
  }

  body.dark-mode {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
    color: #e0e0e0 !important;
  }

  body.dark-mode header,
  body.dark-mode .card,
  body.dark-mode .container {
    background: rgba(40, 40, 50, 0.95) !important;
    color: #e0e0e0 !important;
  }

  body.dark-mode input,
  body.dark-mode textarea,
  body.dark-mode select {
    background: rgba(255, 255, 255, 0.1) !important;
    border-color: rgba(65, 105, 225, 0.3) !important;
    color: #e0e0e0 !important;
  }

  body.dark-mode input::placeholder,
  body.dark-mode textarea::placeholder {
    color: #888 !important;
  }
</style>
