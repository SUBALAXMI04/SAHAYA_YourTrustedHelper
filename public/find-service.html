<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Find Services - SAHAYA</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #4169E1 0%, #E0E6FF 50%, #D0D8F4 100%);
      min-height: 100vh;
      color: #333;
    }

    header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 20px rgba(65, 105, 225, 0.1);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 30px;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    nav a {
      text-decoration: none;
      color: #666;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-right: 20px;
    }

    nav a:hover {
      color: #4169E1;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .logout-btn {
      padding: 8px 20px;
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .search-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 8px 32px rgba(65, 105, 225, 0.15);
      margin-bottom: 40px;
    }

    .search-title {
      font-size: 28px;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .search-subtitle {
      color: #999;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .search-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 700;
      margin-bottom: 8px;
      color: #4169E1;
      font-size: 13px;
    }

    input, select {
      padding: 12px 15px;
      border: 2px solid #E0E6FF;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
    }

    input:focus, select:focus {
      border-color: #4169E1;
      box-shadow: 0 0 0 3px rgba(65, 105, 225, 0.1);
      outline: none;
    }

    .services-scroll {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .services-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .services-scroll::-webkit-scrollbar-track {
      background: #E0E6FF;
      border-radius: 10px;
    }

    .services-scroll::-webkit-scrollbar-thumb {
      background: #4169E1;
      border-radius: 10px;
    }

    .service-chip {
      padding: 10px 20px;
      border: 2px solid #E0E6FF;
      background: white;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
      transition: all 0.3s ease;
      font-size: 13px;
    }

    .service-chip:hover {
      border-color: #4169E1;
      color: #4169E1;
    }

    .service-chip.selected {
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      color: white;
      border-color: #4169E1;
    }

    .search-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .search-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(65, 105, 225, 0.3);
    }

    .search-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .results-section {
      display: none;
    }

    .results-section.active {
      display: block;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      color: white;
    }

    .results-title {
      font-size: 24px;
      font-weight: 700;
    }

    .results-count {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
    }

    .providers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .provider-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(65, 105, 225, 0.1);
      transition: all 0.3s ease;
    }

    .provider-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(65, 105, 225, 0.2);
    }

    .provider-header {
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .provider-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .provider-service {
      font-size: 13px;
      opacity: 0.9;
    }

    .provider-body {
      padding: 20px;
    }

    .provider-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 13px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .info-label {
      color: #999;
      font-weight: 600;
    }

    .info-value {
      color: #4169E1;
      font-weight: 700;
    }

    .rating {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
    }

    .stars {
      color: #FFD700;
      font-size: 16px;
    }

    .rating-count {
      color: #999;
      font-size: 12px;
    }

    .provider-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4169E1 0%, #5B7FED 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(65, 105, 225, 0.3);
    }

    .btn-secondary {
      background: #E0E6FF;
      color: #4169E1;
    }

    .btn-secondary:hover {
      background: #D0D8F4;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: white;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .empty-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: white;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .search-grid {
        grid-template-columns: 1fr;
      }

      .providers-grid {
        grid-template-columns: 1fr;
      }

      .search-section {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <div class="logo">SAHAYA</div>
      <nav>
        <a href="/dashboard1.html">Dashboard</a>
        <a href="/find-service.html" style="color: #4169E1;">Find Service</a>
        <a href="/saved-pros.html">Saved</a>
      </nav>
    </div>
    <div class="header-right">
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="container">
    <!-- SEARCH SECTION -->
    <div class="search-section">
      <h1 class="search-title">üîç Find Service Providers</h1>
      <p class="search-subtitle">Search for trusted professionals near you</p>

      <form id="searchForm" onsubmit="searchProviders(event)">
        <div class="search-grid">
          <div class="form-group">
            <label>üìç Location (City)</label>
            <input type="text" id="city" placeholder="e.g., Bangalore" required>
          </div>
          <div class="form-group">
            <label>üìç District</label>
            <input type="text" id="district" placeholder="e.g., Bangalore Urban" required>
          </div>
          <div class="form-group">
            <label>üìç State</label>
            <input type="text" id="state" placeholder="e.g., Karnataka" required>
          </div>
        </div>

        <label style="font-weight: 700; margin-bottom: 12px; display: block; color: #4169E1;">Select Service (Scroll to browse all)</label>
        <div class="services-scroll" id="servicesContainer"></div>
        <input type="hidden" id="selectedService" required>

        <button type="submit" class="search-btn" id="searchBtn">Search Providers</button>
      </form>
    </div>

    <!-- RESULTS SECTION -->
    <div class="results-section" id="resultsSection">
      <div class="results-header">
        <div class="results-title">üìã Available Providers</div>
        <div class="results-count" id="resultCount">0 providers found</div>
      </div>

      <div id="loadingState" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>Searching providers...</p>
      </div>

      <div id="emptyState" class="empty-state" style="display: none;">
        <div class="empty-icon">üîç</div>
        <div class="empty-title">No providers found</div>
        <p>Try a different location or service</p>
      </div>

      <div class="providers-grid" id="providersGrid"></div>
    </div>
  </div>

  <script>
    const ALL_SERVICES = [
      "AC Technician", "Baby Care", "Barber", "Beautician", "Cable Services",
      "Carpenter", "Cobbler", "Computer Repair", "Cook", "Delivery",
      "Driver", "Elder Care", "Electrician", "Fridge Repair", "Gardener",
      "Hair Stylist", "Internet Services", "Laundry", "Maid", "Mason",
      "Mechanic", "Milkman", "Mobile Repair", "Nurse", "Painter",
      "Pest Control", "Photographer", "Plumber", "RO Services", "Security",
      "Tailor", "TV Repair", "Washing Machine Repair"
    ];

    function initializeServices() {
      const container = document.getElementById('servicesContainer');
      container.innerHTML = ALL_SERVICES.map(service => `
        <div class="service-chip" onclick="selectService(this, '${service}')">${service}</div>
      `).join('');
    }

    function selectService(element, service) {
      document.querySelectorAll('.service-chip').forEach(chip => chip.classList.remove('selected'));
      element.classList.add('selected');
      document.getElementById('selectedService').value = service;
    }

    async function searchProviders(e) {
      e.preventDefault();

      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/user-login.html';
        return;
      }

      const city = document.getElementById('city').value;
      const district = document.getElementById('district').value;
      const state = document.getElementById('state').value;
      const service = document.getElementById('selectedService').value;

      if (!service) {
        alert('Please select a service');
        return;
      }

      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('providersGrid').innerHTML = '';
      document.getElementById('resultsSection').classList.add('active');

      try {
        const response = await fetch('/services/search', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ service, city, district, state })
        });

        const data = await response.json();
        document.getElementById('loadingState').style.display = 'none';

        if (data.success && data.providers.length > 0) {
          displayProviders(data.providers);
          document.getElementById('resultCount').textContent = `${data.count} provider${data.count !== 1 ? 's' : ''} found`;
        } else {
          document.getElementById('emptyState').style.display = 'block';
          document.getElementById('resultCount').textContent = '0 providers found';
        }
      } catch (error) {
        console.error('Search error:', error);
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('emptyState').style.display = 'block';
      }
    }

    function displayProviders(providers) {
      const grid = document.getElementById('providersGrid');
      grid.innerHTML = providers.map(provider => `
        <div class="provider-card">
          <div class="provider-header">
            <div class="provider-name">${provider.name}</div>
            <div class="provider-service">${provider.service}</div>
          </div>
          <div class="provider-body">
            <div class="rating">
              <div class="stars">${'‚≠ê'.repeat(Math.round(provider.rating))}</div>
              <div class="rating-count">${provider.rating.toFixed(1)} (${provider.reviews_count})</div>
            </div>
            <div class="provider-info">
              <div class="info-item">
                <div class="info-label">Jobs Done</div>
                <div class="info-value">${provider.total_jobs}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Location</div>
                <div class="info-value">${provider.city}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Phone</div>
                <div class="info-value">${provider.phone ? provider.phone.substring(0, 4) + '****' : 'N/A'}</div>
              </div>
            </div>
            <div class="provider-actions">
              <button class="btn btn-primary" onclick="connectProvider(${provider.id})">Connect</button>
              <button class="btn btn-secondary" onclick="viewProfile(${provider.id})">View Profile</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    async function connectProvider(providerId) {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch('/chat/connect', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ provider_id: providerId })
        });

        const data = await response.json();
        if (data.success) {
          alert('‚úÖ Connection request sent! The provider will review your request.');
          // Redirect to chat
          window.location.href = `/chat.html?chat_id=${data.chat_id}`;
        } else {
          alert(data.error);
        }
      } catch (error) {
        console.error('Error connecting:', error);
        alert('Failed to connect. Please try again.');
      }
    }

    function viewProfile(providerId) {
      window.location.href = `/provider-profile.html?provider_id=${providerId}`;
    }

    function logout() {
      localStorage.clear();
      window.location.href = '/landing.html';
    }

    function toggleTheme() {
      const currentTheme = localStorage.getItem('theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      if (newTheme === 'dark') {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      localStorage.setItem('theme', newTheme);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Check authentication
      const token = localStorage.getItem('token');
      const userType = localStorage.getItem('userType');
      
      if (!token || userType !== 'user') {
        window.location.href = '/landing.html';
        return;
      }

      // Apply saved theme
      const savedTheme = localStorage.getItem('theme') || 'light';
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
      }

      initializeServices();
    });
  </script>
</body>
</html>
