<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chat</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header">Chat</div>
<div class="container">
  <div id="messages" style="height:300px;overflow-y:scroll;border:1px solid var(--accent);padding:5px;"></div>
  <input type="text" id="msg" placeholder="Type message">
  <button onclick="sendMsg()">Send</button>
</div>

<script>
const token = localStorage.getItem('token');
const urlParams = new URLSearchParams(window.location.search);
const booking_id = urlParams.get('booking');

async function loadMessages(){
  const res = await fetch('http://localhost:3000/chat/'+booking_id,{headers:{'Authorization':'Bearer '+token}});
  const data = await res.json();
  const div = document.getElementById('messages');
  div.innerHTML='';
  data.forEach(m=>{
    div.innerHTML+=`<p><strong>${m.sender_role}:</strong> ${m.message}</p>`;
  });
  div.scrollTop = div.scrollHeight;
}

async function sendMsg(){
  const message = document.getElementById('msg').value;
  await fetch('http://localhost:3000/chat/send',{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
    body: JSON.stringify({booking_id,message})
  });
  document.getElementById('msg').value='';
  loadMessages();
}

setInterval(loadMessages,3000);
loadMessages();
</script>
</body>
</html>
